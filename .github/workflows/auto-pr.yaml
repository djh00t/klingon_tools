name: Auto PR for New Branches

on:
  # Push to all but main and master
  push:
    branches-ignore:
      - main
      - master

jobs:
  create-pr:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install GitHub CLI
        run: sudo apt-get install -y gh

      - name: Fetch commit messages
        id: commit_messages
        run: |
          git fetch origin main
          COMMITS=$(git log origin/main..HEAD --pretty=format:"%s" || echo "No conventional commits found.")
          echo "::set-output name=commits::$COMMITS"

      - name: Create Pull Request
        env:
          GH_TOKEN: ""
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}
        run: |
          unset GH_TOKEN
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token
          gh auth status
          gh pr create --base main --head ${{ github.ref }} --title "Pull Request for new branch ${{ github.ref }} created by ${{ github.actor }}" --body "This PR is automatically created for the new branch ${{ github.ref }}.

          Changes:
          ${{ steps.commit_messages.outputs.commits }}"
